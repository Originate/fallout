!function(t,e){var n;return"function"==typeof define&&define.amd?define(["immutable","exports"],function(n,o){return t.Fallout=e(t,o,n)}):"undefined"!=typeof exports?(n=require("immutable"),e(t,exports,n)):t.Fallout=e(t,{},t.Immutable)}(this,function(t,e,n){return e.Immutable=n,e.Store=function(){function t(){this.data=n.Map(),this.listeners=[]}return t.prototype.emitChange=function(){var t,e,n,o,i;for(o=this.listeners,i=[],t=0,e=o.length;e>t;t++)n=o[t],i.push(n.call(this));return i},t.prototype.observe=function(t){return this.listeners.indexOf(t)>=0?void 0:this.listeners.push(t)},t.prototype.ignore=function(t){var e;return e=this.listeners.indexOf(t),e>=0?this.listeners.splice(e,1):void 0},t.prototype.checkOut=function(){return this.data.toJS()},t.prototype.checkIn=function(t){return this.data=this.data.mergeDeep(t),this.emitChange()},t}(),e.store=new e.Store,e.actions={},e.defineActionSet=function(t,n){return e.actions[t]=n,e.actions[t].store=e.store},e.Mixin={componentWillMount:function(){var t,n,o,i;this.actions=e.actions,n=this._falloutWatchSelectors(),o=[];for(t in n)i=n[t],o.push(this._updateStateFromFallout(t,e.store.data.getIn(i)));return o},componentDidMount:function(){return e.store.observe(this.onFalloutStoreChange)},componentWillUnmount:function(){return e.store.ignore(this.onFalloutStoreChange)},onFalloutStoreChange:function(){var t,n,o,i,r;n=this._falloutWatchSelectors(),o=[];for(t in n)i=n[t],r=e.store.data.getIn(i),o.push(this.state["_"+t]!==r?this._updateStateFromFallout(t,r):void 0);return o},_falloutWatchSelectors:function(){var t;return null!=this.watch?t="function"==typeof this.watch?this.watch():this.watch:{}},_updateStateFromFallout:function(t,e){var n;return n={},n[t]=null!=e&&null!=e.toJS?e.toJS():e,n["_"+t]=e,this.setState(n)}},e});